<%- include('partials/header') %>

    <!-- Navigation bar -->
    <nav class="navbar">
        <ul>
            <li><a href="/home">Home</a></li>
            <li><a href="/portfolio">Portfolio</a></li>
            <li><a href="/marketdata">Market Data</a></li>
        </ul>
    </nav>

    <!-- Settings and Log Out links -->
    <div class="profile-links">
        <a href="/settings">Settings</a>
        <a href="/logout">Log Out</a>
    </div>

    <!-- Trade section -->
    <section class="trade-section">
        <h2 class="title">Trade Cryptocurrency</h2>

        <!-- Display Holdings -->
        <h2>Your Holdings</h2>
        <ul>
            <% holdings.forEach(holding=> { %>
                <li>
                    <h3>
                        <%= holding.name %>
                    </h3>
                    <p>Quantity: <%= holding.quantity %>
                    </p>
                    <form action="/trade/<%= holding._id %>/delete" method="DELETE">
                        <button type="submit">Delete</button>
                    </form>
                    <a href="/trade/<%= holding._id %>/edit">Edit</a>
                </li>
                <% }); %>
        </ul>

        <!-- buy form -->
        <h2>Buy</h2>
        <form action="/trades" method="post">
            <label for="crypto">Cryptocurrency:</label>
            <select id="crypto" name="cryptoType">
                <% cryptocurrencies.forEach(crypto=> { %>
                    <option value="<%= crypto.id %>">
                        <%= crypto.name %>
                    </option>
                    <% }); %>
            </select>
            <label for="usdAmount">Amount (USD):</label>
            <div class="symbol">
                <span class="money-symbol">$</span>
                <input type="number" id="usdAmount" name="amount" step="0.01" min="0.01" required>
            </div>
            <input type="hidden" name="userId" value="<%= userId %>">
            <input type="hidden" name="price" value="10">
            <button type="submit">Buy</button>
        </form>

        <!-- sell form -->
        <h2>Sell</h2>
        <form action="/trades/sell/<%= user._id %>" method="get">
            <input type="hidden" name="userId" value="<%= user._id %>">
            <label for="crypto">Cryptocurrency:</label>
            <select id="crypto" name="cryptoType">
                <% cryptocurrencies.forEach(crypto=> { %>
                    <option value="<%= crypto.id %>">
                        <%= crypto.name %>
                    </option>
                    <% }); %>
            </select>
            <label for="usdAmount">Amount (USD):</label>
            <div class="symbol">
                <span class="money-symbol">$</span>
                <input type="number" id="usdAmount" name="usdAmount" step="0.01" min="0.01" required>
            </div>
            <button type="submit">Sell</button>
        </form>


        <!-- Cryptocurrency list -->
        <h2>Cryptocurrencies</h2>
        <ul>
            <% marketData.forEach(coin=> { %>
                <li>
                    <h3>
                        <%= coin.name %>
                    </h3>
                    <p>Symbol: <%= coin.symbol %>
                    </p>
                    <p>Price: <%= coin.current_price %> USD</p>
                    <p>Market Cap: <%= coin.market_cap %> USD</p>
                    <p>High (24h): <%= coin.high_24h %> USD</p>
                    <p>Low (24h): <%= coin.low_24h %> USD</p>
                    <p>Price Change (24h): <%= coin.price_change_24h %> USD</p>
                    <p>Market Cap Rank: <%= coin.market_cap_rank %>
                    </p>
                    <p>Circulating Supply: <%= coin.circulating_supply %>
                    </p>
                    <p>Total Volume: <%= coin.total_volume %>
                    </p>
                    <p>All-Time High: <%= coin.ath %> USD (on <%= coin.ath_date %>)</p>
                    <p>All-Time Low: <%= coin.atl %> USD (on <%= coin.atl_date %>)</p>
                    <% if (coin.roi) { %>
                        <p>ROI: <%= coin.roi.times %> times (<%= coin.roi.currency %>)</p>
                        <% } %>
                </li>
                <% }); %>
        </ul>

    </section>

    <%- include('partials/footer') %>